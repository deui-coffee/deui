#!/usr/bin/env node

const fs = require('fs')

const prettier = require('prettier')

const path = require('path')

const profiles = []

fs.readdirSync(path.resolve(__dirname, '../public/profiles')).forEach((filename) => {
    const profile = JSON.parse(
        fs.readFileSync(path.resolve(__dirname, '../public/profiles', filename))
    )

    profiles.push({
        name: profile.title,
        id: filename.replace(/\.json$/, ''),
        visible: !profile.hidden,
    })
})

prettier.resolveConfig(__dirname).then((options) => {
    const json = prettier.format(JSON.stringify(profiles), { ...options, parser: 'json' })

    fs.writeFileSync(path.resolve(__dirname, '../src/generated/profiles.json'), json)
})
